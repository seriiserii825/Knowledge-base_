# Post

### –ü–ª–æ—Ö–æ–π –ø—Ä–∏–º–µ—Ä

–ö–ª–∞—Å—Å Post –∏ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ –≤ localStorage

```ts
class Post {
  id: number;
  title: string;
  content: string;
  constructor(id: number, title: string, content: string) {
    this.id = id;
    this.title = title;
    this.content = content;
  }
}

class PostLocalStorage {
  getAll(): Post[] {}
  getOne(id: number): Post {}
  add(post: Post): void {}
}
```

–ü–æ—Ç–æ–º –Ω—É–∂–Ω–æ –∑–∞–º–µ–Ω–∏—Ç—å —Ö—Ä–∞–Ω–∏–ª–∏—â–µ –Ω–∞ –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö

```ts
class PostDbRepository {
  create(): Post[] {}
  findOne(id: number): Post {}
  findAll(post: Post): void {}
}
```

–ü–æ—Ç–æ–º –Ω–∞ –∫—ç—à

```ts
class PostCacheRepository {
  findAll(): Post[] {}
  findOne(id: number): Post {}
  addToCache(post: Post): void {}
}
```

–ü—Ä–æ–±–ª–µ–º–∞ –≤ —Ç–æ–º, —á—Ç–æ –∫–∞–∂–¥—ã–π —Ä–∞–∑ –ø—Ä–∏—Ö–æ–¥–∏—Ç—Å—è –º–µ–Ω—è—Ç—å –∫–æ–¥, –∫–æ–≥–¥–∞ –º–µ–Ω—è–µ—Ç—Å—è —Å–ø–æ—Å–æ–± —Ö—Ä–∞–Ω–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö.
–≠—Ç–æ –Ω–∞—Ä—É—à–∞–µ—Ç –ø—Ä–∏–Ω—Ü–∏–ø –∏–Ω–≤–µ—Ä—Å–∏–∏ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π.

### –•–æ—Ä–æ—à–∏–π –ø—Ä–∏–º–µ—Ä

```ts
// ===== –î–æ–º–µ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ =====
class Post {
  constructor(public id: number, public title: string, public content: string) {}
}

// ===== –ê–±—Å—Ç—Ä–∞–∫—Ü–∏—è –ø–æ DIP =====
interface PostRepository {
  getAll(): Promise<Post[]>;
  getOne(id: number): Promise<Post | null>;
  add(post: Post): Promise<void>;
}

// ===== –†–µ–∞–ª–∏–∑–∞—Ü–∏—è: localStorage =====
class PostLocalStorage implements PostRepository {
  private key = "posts";

  private read(): Post[] {
    try {
      return JSON.parse(localStorage.getItem(this.key) ?? "[]");
    } catch {
      return [];
    }
  }
  private write(posts: Post[]) {
    localStorage.setItem(this.key, JSON.stringify(posts));
  }

  async getAll(): Promise<Post[]> {
    return this.read();
  }
  async getOne(id: number): Promise<Post | null> {
    return this.read().find((p) => p.id === id) ?? null;
  }
  async add(post: Post): Promise<void> {
    const list = this.read();
    list.push(post);
    this.write(list);
  }
}

// ===== –†–µ–∞–ª–∏–∑–∞—Ü–∏—è: –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö (–∑–∞–≥–ª—É—à–∫–∏) =====
class PostDbRepository implements PostRepository {
  async getAll(): Promise<Post[]> {
    // SELECT * FROM posts
    return [];
  }
  async getOne(id: number): Promise<Post | null> {
    // SELECT * FROM posts WHERE id = ?
    return null;
  }
  async add(post: Post): Promise<void> {
    // INSERT INTO posts (...)
  }
}

// ===== –†–µ–∞–ª–∏–∑–∞—Ü–∏—è: –∫—ç—à =====
// –î–µ–ª–∞–µ–º –∫—ç—à –ø—Ä–æ–∑—Ä–∞—á–Ω–æ–π –æ–±—ë—Ä—Ç–∫–æ–π –≤–æ–∫—Ä—É–≥ –ª—é–±–æ–≥–æ PostRepository.
// –ù–∏–∫–∞–∫–∏—Ö –Ω–æ–≤—ã—Ö —Å—É—â–Ω–æ—Å—Ç–µ–π ‚Äî —Ç–æ–ª—å–∫–æ —Ç–≤–æ–π PostCacheRepository.
class PostCacheRepository implements PostRepository {
  private allCache?: Post[];
  private oneCache = new Map<number, Post | null>();

  constructor(private inner: PostRepository) {}

  async getAll(): Promise<Post[]> {
    if (!this.allCache) this.allCache = await this.inner.getAll();
    return this.allCache;
  }
  async getOne(id: number): Promise<Post | null> {
    if (!this.oneCache.has(id)) {
      this.oneCache.set(id, await this.inner.getOne(id));
    }
    return this.oneCache.get(id)!;
  }
  async add(post: Post): Promise<void> {
    await this.inner.add(post);
    // –ü—Ä–æ—Å—Ç–∞—è –∏–Ω–≤–∞–ª–∏–¥–∞—Ü–∏—è
    this.allCache = undefined;
    this.oneCache.delete(post.id);
  }
}

// ===== –ö–ª–∏–µ–Ω—Ç—Å–∫–∏–π –∫–æ–¥ (–∑–∞–≤–∏—Å–∏—Ç –æ—Ç –∞–±—Å—Ç—Ä–∞–∫—Ü–∏–∏) =====
async function demo(repo: PostRepository) {
  await repo.add(new Post(1, "Hello", "World"));
  console.log(await repo.getAll());
  console.log(await repo.getOne(1));
}

// ===== –í—ã–±–æ—Ä —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ ‚Äî –≤ –æ–¥–Ω–æ–º –º–µ—Å—Ç–µ =====
const repo1 = new PostLocalStorage();
const repo2 = new PostDbRepository();
const repoWithCache = new PostCacheRepository(repo2);

// –ú–æ–∂–Ω–æ –ø–æ–¥—Å—Ç–∞–≤–ª—è—Ç—å –ª—é–±—É—é –∏–∑ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–π –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏—è demo():
demo(repoWithCache);
```

## üí° –í—ã–≤–æ–¥ –ø–æ DIP (Dependency Inversion Principle)

–ü—Ä–∏–Ω—Ü–∏–ø –∏–Ω–≤–µ—Ä—Å–∏–∏ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π –≥–æ–≤–æ—Ä–∏—Ç, —á—Ç–æ **–≤—ã—Å–æ–∫–æ—É—Ä–æ–≤–Ω–µ–≤—ã–µ –º–æ–¥—É–ª–∏ –Ω–µ –¥–æ–ª–∂–Ω—ã –∑–∞–≤–∏—Å–µ—Ç—å –æ—Ç –Ω–∏–∑–∫–æ—É—Ä–æ–≤–Ω–µ–≤—ã—Ö**, –∞ **–æ–±–∞ –¥–æ–ª–∂–Ω—ã –∑–∞–≤–∏—Å–µ—Ç—å –æ—Ç –∞–±—Å—Ç—Ä–∞–∫—Ü–∏–π**.

–í –Ω–∞—à–µ–º –ø—Ä–∏–º–µ—Ä–µ:

- **–í—ã—Å–æ–∫–æ—É—Ä–æ–≤–Ω–µ–≤—ã–π –∫–æ–¥** ‚Äî —ç—Ç–æ –ª–æ–≥–∏–∫–∞ —Ä–∞–±–æ—Ç—ã —Å –ø–æ—Å—Ç–∞–º–∏ (`run()`, `PostService`, –∏ —Ç. –¥.).
- **–ù–∏–∑–∫–æ—É—Ä–æ–≤–Ω–µ–≤—ã–π –∫–æ–¥** ‚Äî —ç—Ç–æ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ —Ö—Ä–∞–Ω–∏–ª–∏—â–∞ (`PostLocalStorage`, `PostDbRepository`, `PostCacheRepository`).
- **–ê–±—Å—Ç—Ä–∞–∫—Ü–∏—è** ‚Äî —ç—Ç–æ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å `PostRepository`, –∫–æ—Ç–æ—Ä—ã–π –∑–∞–¥–∞—ë—Ç –µ–¥–∏–Ω—ã–π –∫–æ–Ω—Ç—Ä–∞–∫—Ç –¥–ª—è –≤—Å–µ—Ö —Ö—Ä–∞–Ω–∏–ª–∏—â.

–ë–ª–∞–≥–æ–¥–∞—Ä—è —ç—Ç–æ–π –∞–±—Å—Ç—Ä–∞–∫—Ü–∏–∏:

- –í—ã—Å–æ–∫–æ—É—Ä–æ–≤–Ω–µ–≤—ã–π –∫–æ–¥ —Ä–∞–±–æ—Ç–∞–µ—Ç —Ç–æ–ª—å–∫–æ —Å `PostRepository`, –∞ –Ω–µ —Å –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–º –∫–ª–∞—Å—Å–æ–º —Ö—Ä–∞–Ω–µ–Ω–∏—è.
- –†–µ–∞–ª–∏–∑–∞—Ü–∏—é –º–æ–∂–Ω–æ –ª–µ–≥–∫–æ –∑–∞–º–µ–Ω–∏—Ç—å ‚Äî –Ω–∞–ø—Ä–∏–º–µ—Ä, –ø–µ—Ä–µ–π—Ç–∏ —Å `localStorage` –Ω–∞ –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö –∏–ª–∏ –∫—ç—à, **–±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏—è –æ—Å—Ç–∞–ª—å–Ω–æ–≥–æ –∫–æ–¥–∞**.
- –¢–∞–∫–∏–º –æ–±—Ä–∞–∑–æ–º, –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å ‚Äú–ø–µ—Ä–µ–≤–æ—Ä–∞—á–∏–≤–∞–µ—Ç—Å—è‚Äù:  
  —Ä–∞–Ω—å—à–µ –ª–æ–≥–∏–∫–∞ –∑–∞–≤–∏—Å–µ–ª–∞ –æ—Ç –¥–µ—Ç–∞–ª–µ–π —Ö—Ä–∞–Ω–µ–Ω–∏—è,  
  —Ç–µ–ø–µ—Ä—å **–¥–µ—Ç–∞–ª–∏ –∑–∞–≤–∏—Å—è—Ç –æ—Ç –∞–±—Å—Ç—Ä–∞–∫—Ü–∏–∏**, –∫–æ—Ç–æ—Ä—É—é –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞.

---

### üîç –°–º—ã—Å–ª ‚Äú–∏–Ω–≤–µ—Ä—Å–∏–∏‚Äù

‚Äú–ò–Ω–≤–µ—Ä—Å–∏—è‚Äù –æ–∑–Ω–∞—á–∞–µ—Ç **–ø–µ—Ä–µ–≤–æ—Ä–æ—Ç –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏**:

- –ë—ã–ª–æ: `–≤—ã—Å–æ–∫–æ—É—Ä–æ–≤–Ω–µ–≤—ã–π –∫–æ–¥ ‚Üí –∫–æ–Ω–∫—Ä–µ—Ç–Ω–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è`.
- –°—Ç–∞–ª–æ: `–≤—ã—Å–æ–∫–æ—É—Ä–æ–≤–Ω–µ–≤—ã–π –∫–æ–¥ ‚Üí –∞–±—Å—Ç—Ä–∞–∫—Ü–∏—è ‚Üê –∫–æ–Ω–∫—Ä–µ—Ç–Ω–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è`.

---

### ‚úÖ –†–µ–∑—É–ª—å—Ç–∞—Ç

- –ö–æ–¥ —Å—Ç–∞–ª **–≥–∏–±–∫–∏–º** ‚Äî –ª–µ–≥–∫–æ –º–µ–Ω—è—Ç—å —Å–ø–æ—Å–æ–± —Ö—Ä–∞–Ω–µ–Ω–∏—è.
- –ö–æ–¥ —Å—Ç–∞–ª **—Ç–µ—Å—Ç–∏—Ä—É–µ–º—ã–º** ‚Äî –º–æ–∂–Ω–æ –ø–æ–¥—Å—Ç–∞–≤–∏—Ç—å —Ñ–µ–π–∫–æ–≤—ã–π —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π –≤ —Ç–µ—Å—Ç–∞—Ö.
- –ö–æ–¥ —Å—Ç–∞–ª **—É—Å—Ç–æ–π—á–∏–≤—ã–º –∫ –∏–∑–º–µ–Ω–µ–Ω–∏—è–º** ‚Äî –ø—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ –Ω–æ–≤—ã—Ö —Ç–∏–ø–æ–≤ —Ö—Ä–∞–Ω–∏–ª–∏—â (–Ω–∞–ø—Ä–∏–º–µ—Ä, API, Redis –∏ —Ç.–¥.) –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞ –Ω–µ –º–µ–Ω—è–µ—Ç—Å—è.

---

> **–ò—Ç–æ–≥:**  
> DIP –ø–æ–∑–≤–æ–ª—è–µ—Ç –æ—Ç–¥–µ–ª–∏—Ç—å ‚Äú—á—Ç–æ –¥–µ–ª–∞–µ—Ç –ø—Ä–æ–≥—Ä–∞–º–º–∞‚Äù –æ—Ç ‚Äú–∫–∞–∫ –∏–º–µ–Ω–Ω–æ —ç—Ç–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ‚Äù.  
> –ë–ª–∞–≥–æ–¥–∞—Ä—è —ç—Ç–æ–º—É, –º—ã —É–ø—Ä–∞–≤–ª—è–µ–º –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—è–º–∏ —á–µ—Ä–µ–∑ –∞–±—Å—Ç—Ä–∞–∫—Ü–∏–∏, –∞ –Ω–µ —á–µ—Ä–µ–∑ –¥–µ—Ç–∞–ª–∏ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏.
