### ü™∂ Flyweight (–õ–µ–≥–∫–æ–≤–µ—Å)

–°—Ç—Ä—É–∫—Ç—É—Ä–Ω—ã–π –ø–∞—Ç—Ç–µ—Ä–Ω, –∫–æ—Ç–æ—Ä—ã–π —É–º–µ–Ω—å—à–∞–µ—Ç –ø–æ—Ç—Ä–µ–±–ª–µ–Ω–∏–µ –ø–∞–º—è—Ç–∏, —Ä–∞–∑–¥–µ–ª—è—è –æ–±—â–∏–µ –¥–∞–Ω–Ω—ã–µ –º–µ–∂–¥—É –º–Ω–æ–∂–µ—Å—Ç–≤–æ–º –æ–±—ä–µ–∫—Ç–æ–≤.

‚ùì –ß—Ç–æ —ç—Ç–æ?
Flyweight ‚Äî –ø–∞—Ç—Ç–µ—Ä–Ω, –∫–æ—Ç–æ—Ä—ã–π –ø–æ–∑–≤–æ–ª—è–µ—Ç —Ö—Ä–∞–Ω–∏—Ç—å –æ–±—â–∏–µ (–∏–Ω–≤–∞—Ä–∏–∞–Ω—Ç–Ω—ã–µ) –¥–∞–Ω–Ω—ã–µ –≤ –æ–¥–Ω–æ–º –º–µ—Å—Ç–µ, –∞ —Ä–∞–∑–Ω—ã–µ (—É–Ω–∏–∫–∞–ª—å–Ω—ã–µ) –¥–∞–Ω–Ω—ã–µ ‚Äî —Å–Ω–∞—Ä—É–∂–∏.

–ö–∞–∂–¥—ã–π ¬´–ª–µ–≥–∫–æ–≤–µ—Å¬ª ‚Äî —ç—Ç–æ –æ–±—ä–µ–∫—Ç, –∫–æ—Ç–æ—Ä—ã–π —Å–æ–¥–µ—Ä–∂–∏—Ç —Ç–æ–ª—å–∫–æ —Ç—É —á–∞—Å—Ç—å –¥–∞–Ω–Ω—ã—Ö, –∫–æ—Ç–æ—Ä—É—é –º–æ–∂–Ω–æ —Ä–∞–∑–¥–µ–ª–∏—Ç—å.

–£–Ω–∏–∫–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –ø–µ—Ä–µ–¥–∞—é—Ç—Å—è –∏–∑–≤–Ω–µ –ø—Ä–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–∏ –º–µ—Ç–æ–¥–∞.

### ü§î –ó–∞—á–µ–º?

–ß—Ç–æ–±—ã —Ä–µ—à–∏—Ç—å –ø—Ä–æ–±–ª–µ–º—É:

üëâ ¬´–û—á–µ–Ω—å –º–Ω–æ–≥–æ –æ–¥–Ω–æ—Ç–∏–ø–Ω—ã—Ö –æ–±—ä–µ–∫—Ç–æ–≤ ‚Üí –æ–≥—Ä–æ–º–Ω–∞—è –ø–∞–º—è—Ç—å ‚Üí —Ç–æ—Ä–º–æ–∑–∞¬ª
–ù–∞–ø—Ä–∏–º–µ—Ä:

- –ú–∏–ª–ª–∏–æ–Ω—ã —ç–ª–µ–º–µ–Ω—Ç–æ–≤ –≤ –∏–≥—Ä–µ (–¥–µ—Ä–µ–≤—å—è, –∫–∞–º–Ω–∏, –ø—É–ª–∏)
- –¢—ã—Å—è—á–∏ –∏–∫–æ–Ω–æ–∫/–±—É–∫–≤ —Ç–µ–∫—Å—Ç–∞
- –ú–Ω–æ–≥–æ –æ–¥–∏–Ω–∞–∫–æ–≤—ã—Ö –∑–Ω–∞—á–µ–Ω–∏–π –≤ –º–æ–¥–µ–ª–∏ –¥–∞–Ω–Ω—ã—Ö

Flyweight —Ä–∞–∑–¥–µ–ª—è–µ—Ç –æ–±—â–∏–µ –¥–∞–Ω–Ω—ã–µ, —á—Ç–æ–±—ã –Ω–µ –¥—É–±–ª–∏—Ä–æ–≤–∞—Ç—å –∏—Ö –≤ –∫–∞–∂–¥–æ–º –æ–±—ä–µ–∫—Ç–µ.

### üß≠ –ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å?

–ò—Å–ø–æ–ª—å–∑—É–π Flyweight, –µ—Å–ª–∏:

‚úî 1. –£ —Ç–µ–±—è –º–Ω–æ–≥–æ –æ–¥–∏–Ω–∞–∫–æ–≤—ã—Ö –æ–±—ä–µ–∫—Ç–æ–≤
100k, 1M, 10M ‚Äî –Ω–µ –≤–∞–∂–Ω–æ.

‚úî 2. –ë–æ–ª—å—à–∞—è —á–∞—Å—Ç—å –∏—Ö –¥–∞–Ω–Ω—ã—Ö ‚Äî –ø–æ–≤—Ç–æ—Ä—è–µ—Ç—Å—è
–ø—Ä–∏–º–µ—Ä: –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∏–∫–æ–Ω–∫–∏ —É 1000 –∫–Ω–æ–ø–æ–∫.

‚úî 3. –ù–µ–ª—å–∑—è –¥–µ—Ä–∂–∞—Ç—å —Ç–∞–∫—É—é –º–∞—Å—Å—É –æ–±—ä–µ–∫—Ç–æ–≤ –ø–æ–ª–Ω–æ—Å—Ç—å—é –≤ –ø–∞–º—è—Ç–∏
–ù—É–∂–Ω–æ —ç–∫–æ–Ω–æ–º–∏—Ç—å.

‚úî 4. –ú–æ–∂–Ω–æ —á—ë—Ç–∫–æ —Ä–∞–∑–¥–µ–ª–∏—Ç—å:
–≤–Ω—É—Ç—Ä–µ–Ω–Ω–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ (–æ–±—â–∏–µ –¥–∞–Ω–Ω—ã–µ)

–≤–Ω–µ—à–Ω–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ (—É–Ω–∏–∫–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ)

### üéØ –õ—É—á—à–∏–π –ø—Ä–∏–º–µ—Ä ‚Äî —Ç–µ–∫—Å—Ç –≤ –±—Ä–∞—É–∑–µ—Ä–µ

–ö–æ–≥–¥–∞ —Ç—ã –≤–≤–æ–¥–∏—à—å —Ç–µ–∫—Å—Ç:

Hello world
–í–Ω—É—Ç—Ä–∏ –±—Ä–∞—É–∑–µ—Ä–∞ –∫–∞–∂–¥–∞—è –±—É–∫–≤–∞ –ù–ï —Ö—Ä–∞–Ω–∏—Ç:

SVG –æ—á–µ—Ä—Ç–∞–Ω–∏—è

- –≤—ã—Å–æ—Ç—É
- —à–∏—Ä–∏–Ω—É
- –º–µ—Ç—Ä–∏–∫–∏
- —à—Ä–∏—Ñ—Ç—ã

–≠—Ç–∏ –¥–∞–Ω–Ω—ã–µ ¬´–≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–µ¬ª ‚Äî –æ–±—â–∏–µ –¥–ª—è –≤—Å–µ—Ö –æ–¥–∏–Ω–∞–∫–æ–≤—ã—Ö —Å–∏–º–≤–æ–ª–æ–≤.

–ë—Ä–∞—É–∑–µ—Ä —Ö—Ä–∞–Ω–∏—Ç 1 –æ–±—ä–µ–∫—Ç –¥–ª—è –±—É–∫–≤—ã "H", 1 –æ–±—ä–µ–∫—Ç –¥–ª—è "e", –∏ —Ç–∞–∫ –¥–∞–ª–µ–µ.

–ê –ø–æ–∑–∏—Ü–∏—è –∫–∞–∂–¥–æ–π –±—É–∫–≤—ã, —Ü–≤–µ—Ç, —Ä–∞–∑–º–µ—Ä ‚Äî —ç—Ç–æ –≤–Ω–µ—à–Ω–∏–µ –¥–∞–Ω–Ω—ã–µ, –∫–æ—Ç–æ—Ä—ã–µ –ø–µ—Ä–µ–¥–∞—é—Ç—Å—è –ø—Ä–∏ —Ä–µ–Ω–¥–µ—Ä–µ.

### üß± –°—Ç—Ä—É–∫—Ç—É—Ä–∞ Flyweight

Client ‚Üí FlyweightFactory ‚Üí Flyweight ‚Üí Operation(extrinsicState)

- FlyweightFactory ‚Äî —Ö—Ä–∞–Ω–∏—Ç –∫—ç—à –ª–µ–≥–∫–æ–≤–µ—Å–æ–≤
- Flyweight ‚Äî –æ–±—ä–µ–∫—Ç —Å –æ–±—â–∏–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ–º
- extrinsicState ‚Äî —É–Ω–∏–∫–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ, –ø–æ—Å—Ç—É–ø–∞—é—â–∏–µ –∏–∑–≤–Ω–µ

üßë‚Äçüíª –ü—Ä–æ—Å—Ç–æ–π –ø—Ä–∏–º–µ—Ä –Ω–∞ TypeScript
üé® –ü—Ä–µ–¥—Å—Ç–∞–≤–∏–º, —á—Ç–æ —É –Ω–∞—Å 100k –∫–Ω–æ–ø–æ–∫ –≤ UI
–í–Ω—É—Ç—Ä–µ–Ω–Ω–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ (–æ–±—â–∏–µ –¥–∞–Ω–Ω—ã–µ):

- –∏–∫–æ–Ω–∫–∞
- —Ñ–æ—Ä–º–∞
- –±–∞–∑–æ–≤—ã–π —Å—Ç–∏–ª—å

–í–Ω–µ—à–Ω–µ–µ (—É–Ω–∏–∫–∞–ª—å–Ω–æ–µ):

- —Ç–µ–∫—Å—Ç
- –ø–æ–∑–∏—Ü–∏—è
- –¥–µ–π—Å—Ç–≤–∏–µ –ø—Ä–∏ –∫–ª–∏–∫–µ

```ts
class ButtonFlyweight {
    constructor(
            private icon: string,
            private shape: string,
            private baseColor: string
            ) {}

    render(label: string, x: number, y: number) {
        console.log(
                `Render button [${label}] at (${x},${y}) with icon=${this.icon}`
                );
    }
}

class ButtonFlyweightFactory {
    private cache: Record<string, ButtonFlyweight> = {};

    getFlyweight(icon: string, shape: string, color: string) {
        const key = `${icon}_${shape}_${color}`;

        if (!this.cache[key]) {
            this.cache[key] = new ButtonFlyweight(icon, shape, color);
        }

        return this.cache[key];
    }
}

// --- usage ---
const factory = new ButtonFlyweightFactory();

// 100k –∫–Ω–æ–ø–æ–∫, –Ω–æ —Å–æ–∑–¥–∞–¥–∏–º –ª–∏—à—å 3 —Ä–∞–∑–Ω—ã—Ö flyweight-–∞
for (let i = 0; i < 100000; i++) {
    const type = i % 3;
    const fw = factory.getFlyweight("icon.svg", "round", ["red", "blue", "green"][type]);
    fw.render(`Button ${i}`, i % 100, Math.floor(i / 100));
}
```
–ú—ã —Å–æ–∑–¥–∞—ë–º 100 000 –∫–Ω–æ–ø–æ–∫, –Ω–æ —Ä–µ–∞–ª—å–Ω—ã–µ –æ–±—ä–µ–∫—Ç—ã ButtonFlyweight –≤ –ø–∞–º—è—Ç–∏ ‚Äî —Ç–æ–ª—å–∫–æ 3.

‚ö° –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞
‚úî –≠–∫–æ–Ω–æ–º–∏—è –ø–∞–º—è—Ç–∏ (–∏–Ω–æ–≥–¥–∞ √ó10, √ó100)
‚úî –£–≤–µ–ª–∏—á–µ–Ω–∏–µ —Å–∫–æ—Ä–æ—Å—Ç–∏
‚úî –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –æ–±—â–∏—Ö –æ–±—ä–µ–∫—Ç–æ–≤
‚ö† –ù–µ–¥–æ—Å—Ç–∞—Ç–∫–∏
‚úò –õ–æ–≥–∏–∫–∞ —É—Å–ª–æ–∂–Ω—è–µ—Ç—Å—è
–ö–æ–¥ —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è –º–µ–Ω–µ–µ –æ—á–µ–≤–∏–¥–Ω—ã–º.

‚úò –ù—É–∂–Ω–æ —á—ë—Ç–∫–æ —Ä–∞–∑–¥–µ–ª–∏—Ç—å –¥–∞–Ω–Ω—ã–µ
–ò–Ω–æ–≥–¥–∞ —ç—Ç–æ —Å–ª–æ–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å.

üß† –ó–∞–ø–æ–º–Ω–∏ –≤ 1 —Ñ—Ä–∞–∑–µ
Flyweight ‚Äî —ç—Ç–æ —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ –æ–±—â–µ–≥–æ —Å–æ—Å—Ç–æ—è–Ω–∏—è –º–µ–∂–¥—É –∫—É—á–µ–π –æ–±—ä–µ–∫—Ç–æ–≤, —á—Ç–æ–±—ã —ç–∫–æ–Ω–æ–º–∏—Ç—å –ø–∞–º—è—Ç—å.
