### 1. –ß—Ç–æ —Ç–∞–∫–æ–µ middleware –≤ NestJS?


Middleware ‚Äî —ç—Ç–æ —Ñ—É–Ω–∫—Ü–∏–∏, –∫–æ—Ç–æ—Ä—ã–µ –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è –¥–æ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∑–∞–ø—Ä–æ—Å–∞ –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–æ–º. –ü—Ä–æ—â–µ –≥–æ–≤–æ—Ä—è, —ç—Ç–æ –∫–æ–¥, –∫–æ—Ç–æ—Ä—ã–π –ø–µ—Ä–µ—Ö–≤–∞—Ç—ã–≤–∞–µ—Ç HTTP-–∑–∞–ø—Ä–æ—Å –∏ –º–æ–∂–µ—Ç:

- –º–æ–¥–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞—Ç—å –æ–±—ä–µ–∫—Ç request –∏–ª–∏ response,
- –∑–∞–≤–µ—Ä—à–∏—Ç—å –∑–∞–ø—Ä–æ—Å (–Ω–∞–ø—Ä–∏–º–µ—Ä, –≤–µ—Ä–Ω—É—Ç—å –æ—à–∏–±–∫—É),
- –≤—ã–∑–≤–∞—Ç—å —Å–ª–µ–¥—É—é—â–∏–π –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –∑–∞–ø—Ä–æ—Å–∞ (—á–µ—Ä–µ–∑ next()).

–í NestJS middleware –ø–æ—Ö–æ–∂–∏ –Ω–∞ —Ç–µ, —á—Ç–æ –µ—Å—Ç—å –≤ Express, –ø–æ—Ç–æ–º—É —á—Ç–æ NestJS –ø–æ—Å—Ç—Ä–æ–µ–Ω –ø–æ–≤–µ—Ä—Ö Express (–∏–ª–∏ Fastify).

### 2. –ó–∞—á–µ–º –Ω—É–∂–Ω—ã middleware?


Middleware –ø–æ–ª–µ–∑–Ω—ã, –∫–æ–≥–¥–∞ –Ω—É–∂–Ω–æ –≤—ã–ø–æ–ª–Ω–∏—Ç—å —á—Ç–æ-—Ç–æ —É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω–æ–µ –¥–ª—è –º–Ω–æ–∂–µ—Å—Ç–≤–∞ –º–∞—Ä—à—Ä—É—Ç–æ–≤, –Ω–∞–ø—Ä–∏–º–µ—Ä:

–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

```ts
console.log(`${req.method} ${req.url}`);
```


‚Äî –∫–∞–∂–¥—ã–π —Ä–∞–∑, –∫–æ–≥–¥–∞ –ø—Ä–∏—Ö–æ–¥–∏—Ç –∑–∞–ø—Ä–æ—Å, –º–æ–∂–Ω–æ –ª–æ–≥–∏—Ä–æ–≤–∞—Ç—å –º–µ—Ç–æ–¥ –∏ –ø—É—Ç—å.

- –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è / –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è (—á–∞—Å—Ç–æ JWT –ø—Ä–æ–≤–µ—Ä–∫–∞)
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ç–æ–∫–µ–Ω –ø–µ—Ä–µ–¥ —Ç–µ–º, –∫–∞–∫ –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä –æ–±—Ä–∞–±–æ—Ç–∞–µ—Ç –∑–∞–ø—Ä–æ—Å.
- –ù–∞–ø—Ä–∏–º–µ—Ä, –µ—Å–ª–∏ –º–Ω–æ–≥–∏–µ –º–∞—Ä—à—Ä—É—Ç—ã –∑–∞—â–∏—â–µ–Ω—ã –æ–¥–∏–Ω–∞–∫–æ–≤–æ.
- –û–±—Ä–∞–±–æ—Ç–∫–∞ CORS –∏–ª–∏ –∑–∞–≥–æ–ª–æ–≤–∫–æ–≤ HTTP
- –î–æ–±–∞–≤–ª—è—Ç—å —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ –∑–∞–≥–æ–ª–æ–≤–∫–∏ –∫ –∫–∞–∂–¥–æ–º—É –∑–∞–ø—Ä–æ—Å—É.
- –ü–∞—Ä—Å–∏–Ω–≥ –¥–∞–Ω–Ω—ã—Ö

–ù–∞–ø—Ä–∏–º–µ—Ä, body parser, –µ—Å–ª–∏ –Ω—É–∂–Ω–∞ –∫–∞—Å—Ç–æ–º–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –∑–∞–ø—Ä–æ—Å–∞.

- Rate limiting
- –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –∑–∞–ø—Ä–æ—Å–æ–≤ —Å –æ–¥–Ω–æ–≥–æ IP.

### 3. –ö–∞–∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å middleware –≤ NestJS

3.1 –°–æ–∑–¥–∞–Ω–∏–µ middleware

–í NestJS –µ—Å—Ç—å –¥–≤–∞ —Å–ø–æ—Å–æ–±–∞: —á–µ—Ä–µ–∑ –∫–ª–∞—Å—Å –∏–ª–∏ —Ñ—É–Ω–∫—Ü–∏—é.

–ß–µ—Ä–µ–∑ –∫–ª–∞—Å—Å:

```ts
import { Injectable, NestMiddleware } from '@nestjs/common';
import { Request, Response, NextFunction } from 'express';

@Injectable()
    export class LoggerMiddleware implements NestMiddleware {
        use(req: Request, res: Response, next: NextFunction) {
            console.log(`[Logger] ${req.method} ${req.url}`);
            next(); // –≤–∞–∂–Ω–æ –≤—ã–∑–≤–∞—Ç—å next(), –∏–Ω–∞—á–µ –∑–∞–ø—Ä–æ—Å "–∑–∞–≤–∏—Å–Ω–µ—Ç"
        }
    }
```


–ß–µ—Ä–µ–∑ —Ñ—É–Ω–∫—Ü–∏—é (–∫–æ—Ä–æ—Ç–∫–æ):

```ts
    import { Request, Response, NextFunction } from 'express';

    export function logger(req: Request, res: Response, next: NextFunction) {
        console.log(`[Logger] ${req.method} ${req.url}`);
        next();
    }
```

### 3.2 –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ middleware


Middleware –º–æ–∂–Ω–æ –ø—Ä–∏–º–µ–Ω—è—Ç—å –Ω–∞ —É—Ä–æ–≤–Ω–µ:

–í—Å–µ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ–º (–≥–ª–æ–±–∞–ª—å–Ω–æ)

```ts
    import { NestFactory } from '@nestjs/core';
    import { AppModule } from './app.module';
    import { LoggerMiddleware } from './logger.middleware';

    async function bootstrap() {
        const app = await NestFactory.create(AppModule);
        app.use(LoggerMiddleware); // –¥–ª—è –≤—Å–µ—Ö –º–∞—Ä—à—Ä—É—Ç–æ–≤
        await app.listen(3000);
    }
bootstrap();
```


–ö–æ–Ω–∫—Ä–µ—Ç–Ω–æ–º—É –º–æ–¥—É–ª—é –∏–ª–∏ –º–∞—Ä—à—Ä—É—Ç—É
–í –º–æ–¥—É–ª–µ –∏—Å–ø–æ–ª—å–∑—É–µ–º configure –º–µ—Ç–æ–¥:

```ts
import { Module, NestModule, MiddlewareConsumer } from '@nestjs/common';
import { LoggerMiddleware } from './logger.middleware';
import { CatsController } from './cats.controller';

@Module({
controllers: [CatsController],
})
export class CatsModule implements NestModule {
    configure(consumer: MiddlewareConsumer) {
        consumer
            .apply(LoggerMiddleware)
            .forRoutes('cats'); // –¥–ª—è –º–∞—Ä—à—Ä—É—Ç–æ–≤ /cats
    }
}
```


–ú–æ–∂–Ω–æ —É–∫–∞–∑–∞—Ç—å –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ –º–µ—Ç–æ–¥—ã –∏–ª–∏ –Ω–µ—Å–∫–æ–ª—å–∫–æ –º–∞—Ä—à—Ä—É—Ç–æ–≤:

```ts
.forRoutes({ path: 'cats', method: RequestMethod.POST });
```

### 4. –û—Ç–ª–∏—á–∏–µ –æ—Ç Guards –∏ Interceptors


- Middleware: –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è –¥–æ –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–∞, –∏–º–µ—é—Ç –¥–æ—Å—Ç—É–ø –∫ req –∏ res.
- Guards: —Ä–µ—à–∞—é—Ç, —Ä–∞–∑—Ä–µ—à–µ–Ω –ª–∏ –¥–æ—Å—Ç—É–ø –∫ –º–∞—Ä—à—Ä—É—Ç—É.
- Interceptors: –º–æ–≥—É—Ç –æ–±–æ—Ä–∞—á–∏–≤–∞—Ç—å –æ—Ç–≤–µ—Ç –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–∞, –º–æ–¥–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç –∏–ª–∏ –≤—ã–ø–æ–ª–Ω—è—Ç—å –∫–æ–¥ –¥–æ/–ø–æ—Å–ª–µ –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–∞.

–ü—Ä–∏–º–µ—Ä: –ø—Ä–æ–≤–µ—Ä–∫–∞ JWT –º–æ–∂–µ—Ç –±—ã—Ç—å middleware –∏–ª–∏ guard, –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Å—Ç–∏–ª—è.

### 5. –ì–¥–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å


–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Å–µ—Ö –∑–∞–ø—Ä–æ—Å–æ–≤ ‚Üí –≥–ª–æ–±–∞–ª—å–Ω–æ middleware

- –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç–æ–∫–µ–Ω–∞ / —Å–µ—Å—Å–∏–∏ ‚Üí middleware –∏–ª–∏ guard
- –î–æ–±–∞–≤–ª–µ–Ω–∏–µ CORS/–∑–∞–≥–æ–ª–æ–≤–∫–æ–≤ ‚Üí –≥–ª–æ–±–∞–ª—å–Ω–æ middleware
- Rate limiting ‚Üí middleware
- –ü–∞—Ä—Å–∏–Ω–≥ –∫–∞—Å—Ç–æ–º–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö ‚Üí middleware

### üí° –ò—Ç–æ–≥:

Middleware ‚Äî —ç—Ç–æ —É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–π –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç, –∫–æ—Ç–æ—Ä—ã–π –ø–æ–º–æ–≥–∞–µ—Ç –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å HTTP-–∑–∞–ø—Ä–æ—Å—ã –¥–æ –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–æ–≤, –≤—ã–ø–æ–ª–Ω—è—Ç—å –æ–±—â–∏–µ –∑–∞–¥–∞—á–∏ –∏ –º–æ–¥–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞—Ç—å –∑–∞–ø—Ä–æ—Å—ã/–æ—Ç–≤–µ—Ç—ã. –ï—Å–ª–∏ –∑–∞–¥–∞—á–∞ –∫–∞—Å–∞–µ—Ç—Å—è –≥–ª–æ–±–∞–ª—å–Ω–æ–π –ª–æ–≥–∏–∫–∏ –∑–∞–ø—Ä–æ—Å–∞, —á–∞—â–µ –≤—Å–µ–≥–æ –∏—Å–ø–æ–ª—å–∑—É—é—Ç middleware. –ï—Å–ª–∏ –ª–æ–≥–∏–∫–∞ –∫–∞—Å–∞–µ—Ç—Å—è —Ä–µ—à–µ–Ω–∏—è –æ –¥–æ—Å—Ç—É–ø–µ –∫ –º–∞—Ä—à—Ä—É—Ç—É, –ª—É—á—à–µ guard.
